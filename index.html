<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Flappy Bird</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  overflow:hidden;
  background:#000;
  touch-action:manipulation;
  font-family:Arial,Helvetica,sans-serif;
}

#game{
  position:relative;
  width:100vw;
  height:100vh;
  background:url(bg.png) repeat-x;
  background-size:auto 100%;
}

#bird{
  position:absolute;
  width:34px;
  height:24px;
  background:url(bird.png) no-repeat center/contain;
  left:25%;
  top:40%;
  z-index:5;
}

.pipe{
  position:absolute;
  width:52px;
  background-size:100% 100%;
}

.pipe.top{
  top:0;
  background-image:url(pipe-top.png);
}

.pipe.bottom{
  bottom:112px;
  background-image:url(pipe-bottom.png);
}

#ground{
  position:absolute;
  bottom:0;
  width:200%;
  height:112px;
  background:url(ground.png) repeat-x;
  background-size:auto 112px;
  animation:groundMove 1.5s linear infinite;
}

@keyframes groundMove{
  from{transform:translateX(0)}
  to{transform:translateX(-50%)}
}

#score{
  position:absolute;
  top:20px;
  width:100%;
  text-align:center;
  font-size:26px;
  color:#fff;
  text-shadow:2px 2px 0 #000;
  z-index:10;
}

#overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.65);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:20;
}

#panel{
  background:#fff;
  padding:22px 30px;
  border-radius:14px;
  text-align:center;
}

#panel h2{
  font-size:22px;
  margin-bottom:10px;
}

#panel button{
  margin-top:12px;
  padding:10px 26px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#ffcc00;
  cursor:pointer;
}

.flash{
  animation:flash .15s;
}
@keyframes flash{
  0%{background:red}
  100%{background:transparent}
}

.shake{
  animation:shake .3s;
}
@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-6px)}
  50%{transform:translateX(6px)}
  75%{transform:translateX(-6px)}
  100%{transform:translateX(0)}
}
</style>
</head>

<body>
<div id="game">
  <div id="score">0</div>
  <div id="bird"></div>
  <div id="ground"></div>

  <div id="overlay">
    <div id="panel">
      <h2>SAO NON Váº¬Y KKK</h2>
      <p id="finalScore"></p>
      <button onclick="startGame()">START</button>
    </div>
  </div>
</div>

<script>
const game = document.getElementById("game");
const bird = document.getElementById("bird");
const overlay = document.getElementById("overlay");
const scoreEl = document.getElementById("score");
const finalScore = document.getElementById("finalScore");

let y, vy, gravity = 0.5;
let pipes = [];
let pipeSpeed = 2.6;
let gapRatio = 0.26;
let score = 0;
let best = localStorage.getItem("bestScore") || 0;
let started = false;
let gameOver = false;
let pipeTimer;

const bgMusic = new Audio("music.mp3");
bgMusic.loop = true;
bgMusic.volume = 0.4;

function init(){
  y = innerHeight * 0.4;
  vy = 0;
  pipes.forEach(p=>p.remove());
  pipes = [];
  score = 0;
  pipeSpeed = 2.6;
  gapRatio = 0.26;
  gameOver = false;
  scoreEl.innerText = score;
  overlay.style.display = "none";
}

function startGame(){
  if(started) return;
  started = true;
  init();

  bgMusic.currentTime = 0;
  bgMusic.play();

  pipeTimer = setInterval(createPipe,1500);
  loop();
}

function loop(){
  if(gameOver) return;

  vy += gravity;
  y += vy;
  bird.style.top = y + "px";
  bird.style.transform = `rotate(${vy*3}deg)`;

  if(y < 0 || y > innerHeight - 136){
    hitEffect();
    endGame();
  }

  updatePipes();
  requestAnimationFrame(loop);
}

function flap(){
  if(!started || gameOver) return;
  vy = -8;
}

function createPipe(){
  const gap = innerHeight * gapRatio;
  const topH = Math.random() *
    (innerHeight - gap - 112 - 140) + 70;

  ["top","bottom"].forEach(type=>{
    const p = document.createElement("div");
    p.className = "pipe " + type;
    p.scored = false;
    p.style.height =
      type==="top" ? topH+"px" :
      (innerHeight - topH - gap - 112)+"px";
    p.style.left = innerWidth + "px";
    game.appendChild(p);
    pipes.push(p);
  });
}

function updatePipes(){
  pipes.forEach(p=>{
    let x = (parseFloat(p.style.left)||0) - pipeSpeed;
    p.style.left = x + "px";

    if(
      p.classList.contains("top") &&
      !p.scored &&
      x + 52 < bird.offsetLeft
    ){
      p.scored = true;
      score++;
      scoreEl.innerText = score;

      if(score % 5 === 0){
        pipeSpeed += 0.3;
        gapRatio = Math.max(0.18, gapRatio - 0.015);
      }
    }

    if(hit(p)){
      hitEffect();
      endGame();
    }

    if(x < -80){
      p.remove();
      pipes = pipes.filter(o=>o!==p);
    }
  });
}

function hit(p){
  const b = bird.getBoundingClientRect();
  const r = p.getBoundingClientRect();
  return !(b.right<r.left || b.left>r.right || b.bottom<r.top || b.top>r.bottom);
}

function hitEffect(){
  game.classList.add("flash");
  bird.classList.add("shake");
  setTimeout(()=>{
    game.classList.remove("flash");
    bird.classList.remove("shake");
  },300);
}

function endGame(){
  if(gameOver) return;
  gameOver = true;
  clearInterval(pipeTimer);
  bgMusic.pause();

  if(score > best){
    best = score;
    localStorage.setItem("bestScore", best);
  }

  finalScore.innerText = `Score: ${score}\nBest: ${best}`;
  overlay.style.display = "flex";
}

addEventListener("mousedown",flap);
addEventListener("touchstart",e=>{e.preventDefault();flap()},{passive:false});
</script>
</body>
</html>
