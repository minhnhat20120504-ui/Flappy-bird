<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Flappy Bird HTML</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  background:#000;
  user-select:none;
}

#game{
  position:relative;
  width:320px;
  height:480px;
  overflow:hidden;
  background:url("bg.png") repeat-x;
  background-size:cover;
}

/* Chim */
#bird{
  position:absolute;
  width:34px;
  height:24px;
  background:url("bird.png") no-repeat center/contain;
  left:60px;
  top:200px;
}

/* Ống */
.pipe{
  position:absolute;
  width:52px;
  background:url("pipe.png") no-repeat center/contain;
}

.pipe.top{
  transform:rotate(180deg);
  top:0;
}

.pipe.bottom{
  bottom:80px;
}

/* Đất */
#ground{
  position:absolute;
  bottom:0;
  width:200%;
  height:80px;
  background:url("ground.png") repeat-x;
  background-size:auto 80px;
}

/* Điểm */
#score{
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  font-size:32px;
  color:white;
  font-weight:bold;
  text-shadow:2px 2px 4px #000;
}
</style>
</head>

<body>

<div id="game">
  <div id="score">0</div>
  <div id="bird"></div>
  <div id="ground"></div>
</div>

<script>
const bird = document.getElementById("bird");
const game = document.getElementById("game");
const ground = document.getElementById("ground");
const scoreEl = document.getElementById("score");

let birdY = 200;
let velocity = 0;
let gravity = 0.45;
let score = 0;
let gameOver = false;
let groundX = 0;

// Nhảy (PC + Mobile)
function jump(){
  if(gameOver) return;
  velocity = -7;
}

document.addEventListener("click", jump);
document.addEventListener("touchstart", jump);
document.addEventListener("keydown", e=>{
  if(e.code === "Space") jump();
});

// Tạo ống
function createPipe(){
  if(gameOver) return;

  const gap = 120;
  const topHeight = Math.random()*200 + 40;
  const bottomHeight = 480 - gap - topHeight - 80;

  const pipeTop = document.createElement("div");
  pipeTop.className = "pipe top";
  pipeTop.style.height = topHeight + "px";
  pipeTop.style.left = "320px";

  const pipeBottom = document.createElement("div");
  pipeBottom.className = "pipe bottom";
  pipeBottom.style.height = bottomHeight + "px";
  pipeBottom.style.left = "320px";

  game.appendChild(pipeTop);
  game.appendChild(pipeBottom);

  let x = 320;
  let passed = false;

  const move = setInterval(()=>{
    if(gameOver){
      clearInterval(move);
      return;
    }

    x -= 2;
    pipeTop.style.left = x + "px";
    pipeBottom.style.left = x + "px";

    if(x < 60 && !passed){
      score++;
      scoreEl.innerText = score;
      passed = true;
    }

    if(hit(pipeTop) || hit(pipeBottom)){
      endGame();
    }

    if(x < -60){
      pipeTop.remove();
      pipeBottom.remove();
      clearInterval(move);
    }
  },20);
}

// Va chạm
function hit(pipe){
  const b = bird.getBoundingClientRect();
  const p = pipe.getBoundingClientRect();

  return !(b.right<p.left || b.left>p.right || b.bottom<p.top || b.top>p.bottom);
}

// Game over
function endGame(){
  gameOver = true;
  setTimeout(()=>{
    alert("Game Over! Score: " + score);
    location.reload();
  },100);
}

// Loop
function loop(){
  if(gameOver) return;

  velocity += gravity;
  birdY += velocity;

  if(birdY < 0) birdY = 0;
  if(birdY > 380) endGame();

  bird.style.top = birdY + "px";

  // Ground scroll
  groundX -= 2;
  ground.style.backgroundPositionX = groundX + "px";

  requestAnimationFrame(loop);
}

setInterval(createPipe,1500);
loop();
</script>

</body>
</html>
