<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Flappy Bird By Pham Minh Nhat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  overflow:hidden;
  background:#000;
  user-select:none;
  touch-action:manipulation;
}

#game{
  position:relative;
  width:100vw;
  height:100vh;
  overflow:hidden;
  background:url("bg.png") repeat-x;
  background-size:cover;
}

/* Chim */
#bird{
  position:absolute;
  width:34px;
  height:24px;
  background:url("bird.png") no-repeat center/contain;
  left:15vw;
  top:40vh;
}

/* ·ªêng */
.pipe{
  position:absolute;
  width:52px;
  background:url("pipe.png") repeat-y center/contain;
}

.pipe.top{
  transform:rotate(180deg);
  top:0;
}

.pipe.bottom{
  bottom:12vh;
}

/* ƒê·∫•t */
#ground{
  position:absolute;
  bottom:0;
  width:200%;
  height:12vh;
  background:url("ground.png") repeat-x;
  background-size:auto 100%;
}

/* ƒêi·ªÉm */
#score{
  position:absolute;
  top:16px;
  left:50%;
  transform:translateX(-50%);
  font-size:36px;
  color:white;
  font-weight:bold;
  text-shadow:2px 2px 4px #000;
  z-index:10;
}
</style>
</head>

<body>

<div id="game">
  <div id="score">0</div>
  <div id="bird"></div>
  <div id="ground"></div>
</div>

<script>
const game = document.getElementById("game");
const bird = document.getElementById("bird");
const ground = document.getElementById("ground");
const scoreEl = document.getElementById("score");

let birdY = window.innerHeight * 0.4;
let velocity = 0;
let gravity = 0.45;
let score = 0;
let gameOver = false;
let groundX = 0;

// Nh·∫£y
function jump(){
  if(gameOver) return;
  velocity = -8;
}

document.addEventListener("click", jump);
document.addEventListener("touchstart", jump);
document.addEventListener("keydown", e=>{
  if(e.code === "Space") jump();
});

// T·∫°o ·ªëng (TO B·∫∞NG NHAU)
function createPipe(){
  if(gameOver) return;

  const gap = window.innerHeight * 0.25;
  const groundH = ground.offsetHeight;

  // üî• ch·ªâ random v·ªã tr√≠ gap
  const offset = Math.random() * (window.innerHeight - gap - groundH - 100) + 50;

  const pipeTop = document.createElement("div");
  pipeTop.className = "pipe top";
  pipeTop.style.height = offset + "px";
  pipeTop.style.left = window.innerWidth + "px";

  const pipeBottom = document.createElement("div");
  pipeBottom.className = "pipe bottom";
  pipeBottom.style.height =
    window.innerHeight - offset - gap - groundH + "px";
  pipeBottom.style.left = window.innerWidth + "px";

  game.appendChild(pipeTop);
  game.appendChild(pipeBottom);

  let x = window.innerWidth;
  let passed = false;

  const move = setInterval(()=>{
    if(gameOver){
      clearInterval(move);
      return;
    }

    x -= 3;
    pipeTop.style.left = x + "px";
    pipeBottom.style.left = x + "px";

    if(x < bird.offsetLeft && !passed){
      score++;
      scoreEl.innerText = score;
      passed = true;
    }

    if(hit(pipeTop) || hit(pipeBottom)){
      endGame();
    }

    if(x < -120){
      pipeTop.remove();
      pipeBottom.remove();
      clearInterval(move);
    }
  },16);
}

// Va ch·∫°m
function hit(pipe){
  const b = bird.getBoundingClientRect();
  const p = pipe.getBoundingClientRect();

  return !(b.right<p.left || b.left>p.right || b.bottom<p.top || b.top>p.bottom);
}

// Game over
function endGame(){
  gameOver = true;
  setTimeout(()=>{
    alert("Game Over! Score: " + score);
    location.reload();
  },100);
}

// Loop
function loop(){
  if(gameOver) return;

  velocity += gravity;
  birdY += velocity;

  if(birdY < 0) birdY = 0;
  if(birdY + bird.offsetHeight > window.innerHeight - ground.offsetHeight){
    endGame();
  }

  bird.style.top = birdY + "px";

  groundX -= 3;
  ground.style.backgroundPositionX = groundX + "px";

  requestAnimationFrame(loop);
}

setInterval(createPipe,1500);
loop();
</script>

</body>
</html>
