<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Flappy Bird By PMN</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  overflow:hidden;
  background:#000;
  user-select:none;
  touch-action:manipulation;
  font-family:sans-serif;
}

/* ===== GAME ===== */
#game{
  position:relative;
  width:100vw;
  height:100vh;
  overflow:hidden;
  background:url("bg.png") repeat-x;
  background-size:auto 100%; /* SCALE CHUẨN */
}

/* ===== BIRD ===== */
#bird{
  position:absolute;
  width:34px;      /* CHUẨN GỐC */
  height:24px;     /* CHUẨN GỐC */
  left:15vw;
  top:40vh;
  background:url("bird.png") no-repeat;
  background-size:100% 100%;
}

/* ===== PIPE ===== */
.pipe{
  position:absolute;
  width:52px; /* CHUẨN GỐC */
  background:url("pipe.png") repeat-y;
  background-size:52px auto;
}
.pipe.top{
  top:0;
  transform:rotate(180deg);
}
.pipe.bottom{
  bottom:112px; /* ĐÚNG BẰNG ĐẤT */
}

/* ===== GROUND ===== */
#ground{
  position:absolute;
  bottom:0;
  width:200%;
  height:112px; /* CHUẨN GỐC */
  background:url("ground.png") repeat-x;
  background-size:auto 112px;
}

/* ===== SCORE ===== */
#score{
  position:absolute;
  top:16px;
  left:50%;
  transform:translateX(-50%);
  font-size:32px;
  color:#fff;
  font-weight:bold;
  text-shadow:2px 2px 4px #000;
  z-index:10;
}

/* ===== GAME OVER ===== */
#overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:20;
}
#panel{
  background:#fff;
  padding:20px 30px;
  border-radius:12px;
  text-align:center;
}
#panel button{
  margin-top:10px;
  padding:10px 20px;
  font-size:16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="game">
  <div id="score"></div>
  <div id="bird"></div>
  <div id="ground"></div>

  <div id="overlay">
    <div id="panel">
      <h2>SAO NON VẬY KKK</h2>
      <p id="finalScore"></p>
      <button onclick="restart()">Chơi Lại</button>
    </div>
  </div>
</div>

<script>
const bird = document.getElementById("bird");
const ground = document.getElementById("ground");
const scoreEl = document.getElementById("score");
const overlay = document.getElementById("overlay");
const finalScore = document.getElementById("finalScore");

let birdY, velocity, score, best;
let pipeSpeed, gapRatio, groundX;
let pipes = [];
let gameOver = false;
let pipeTimer;

function init(){
  birdY = innerHeight * 0.4;
  velocity = 0;
  score = 0;
  best = localStorage.getItem("bestScore") || 0;
  pipeSpeed = 3;
  gapRatio = 0.28;
  groundX = 0;
  gameOver = false;

  pipes.forEach(p=>p.remove());
  pipes = [];

  scoreEl.innerText = `0 | Best: ${best}`;
  overlay.style.display = "none";
}

function jump(){
  if(gameOver) return;
  velocity = -8;
}

addEventListener("click", jump);
addEventListener("touchstart", jump);
addEventListener("keydown", e=>{
  if(e.code==="Space") jump();
});

function createPipe(){
  const gap = innerHeight * gapRatio;
  const groundH = 112;

  const topH = Math.random() *
    (innerHeight - gap - groundH - 140) + 70;

  ["top","bottom"].forEach(type=>{
    const p = document.createElement("div");
    p.className = "pipe " + type;
    p.style.height =
      type==="top" ? topH+"px" :
      (innerHeight - topH - gap - groundH)+"px";
    p.style.left = innerWidth + "px";
    game.appendChild(p);
    pipes.push(p);
  });
}

function updatePipes(){
  pipes.forEach((p,i)=>{
    let x = (parseFloat(p.style.left)||0) - pipeSpeed;
    p.style.left = x + "px";

    if(i%2===0 && x < bird.offsetLeft && !p.passed){
      p.passed = true;
      score++;

      if(score % 5 === 0){
        pipeSpeed += 0.3;
        gapRatio = Math.max(0.18, gapRatio - 0.015);
      }

      scoreEl.innerText = `${score} | Best: ${best}`;
    }

    if(checkHit(p)) endGame();
    if(x < -80){ p.remove(); pipes.shift(); }
  });
}

function checkHit(pipe){
  const b = bird.getBoundingClientRect();
  const p = pipe.getBoundingClientRect();
  return !(b.right<p.left||b.left>p.right||b.bottom<p.top||b.top>p.bottom);
}

function endGame(){
  if(gameOver) return;
  gameOver = true;
  clearInterval(pipeTimer);

  if(score > best){
    best = score;
    localStorage.setItem("bestScore", best);
  }

  finalScore.innerText = `Score: ${score}\nBest: ${best}`;
  overlay.style.display = "flex";
}

function restart(){
  init();
  pipeTimer = setInterval(createPipe,1500);
  loop();
}

function loop(){
  if(gameOver) return;

  velocity += 0.45;
  birdY += velocity;

  if(birdY < 0) birdY = 0;
  if(birdY + 24 > innerHeight - 112){
    endGame(); return;
  }

  bird.style.top = birdY + "px";

  groundX -= pipeSpeed;
  ground.style.backgroundPositionX = groundX + "px";

  updatePipes();
  requestAnimationFrame(loop);
}

init();
pipeTimer = setInterval(createPipe,1500);
loop();
</script>

</body>
</html>
