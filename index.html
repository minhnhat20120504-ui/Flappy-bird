<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Flappy Bird</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  overflow:hidden;
  background:#000;
  user-select:none;
  touch-action:manipulation;
  font-family:sans-serif;
}

#game{
  position:relative;
  width:100vw;
  height:100vh;
  overflow:hidden;
  background:url("bg.png") repeat-x;
  background-size:cover;
}

/* Chim */
#bird{
  position:absolute;
  width:34px;
  height:24px;
  background:url("bird.png") no-repeat center/contain;
  left:15vw;
  top:40vh;
}

/* Ống */
.pipe{
  position:absolute;
  width:52px;
  background:url("pipe.png") repeat-y center/contain;
}
.pipe.top{ transform:rotate(180deg); top:0; }
.pipe.bottom{ bottom:12vh; }

/* Đất */
#ground{
  position:absolute;
  bottom:0;
  width:200%;
  height:12vh;
  background:url("ground.png") repeat-x;
  background-size:auto 100%;
}

/* Điểm */
#score{
  position:absolute;
  top:16px;
  left:50%;
  transform:translateX(-50%);
  font-size:32px;
  color:#fff;
  font-weight:bold;
  text-shadow:2px 2px 4px #000;
  z-index:10;
}

/* Game Over */
#overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:20;
}

#panel{
  background:#fff;
  padding:20px 30px;
  border-radius:12px;
  text-align:center;
}

#panel h1{ margin:0 0 10px; }
#panel button{
  margin-top:10px;
  padding:10px 20px;
  font-size:16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="game">
  <div id="score"></div>
  <div id="bird"></div>
  <div id="ground"></div>

  <div id="overlay">
    <div id="panel">
      <h1>Game Over</h1>
      <p id="finalScore"></p>
      <button onclick="restart()">Restart</button>
    </div>
  </div>
</div>

<script>
const bird = document.getElementById("bird");
const ground = document.getElementById("ground");
const scoreEl = document.getElementById("score");
const overlay = document.getElementById("overlay");
const finalScore = document.getElementById("finalScore");

let birdY, velocity, score, best;
let gameOver, groundX;
let pipeSpeed, gapSize;
let pipes = [];
let pipeTimer;

function init(){
  birdY = innerHeight * 0.4;
  velocity = 0;
  score = 0;
  best = localStorage.getItem("bestScore") || 0;
  gameOver = false;
  groundX = 0;
  pipeSpeed = 3;
  gapSize = 0.28;

  pipes.forEach(p=>p.remove());
  pipes = [];

  overlay.style.display = "none";
  scoreEl.innerText = `0 | Best: ${best}`;
}

function jump(){
  if(gameOver) return;
  velocity = -8;
}

addEventListener("click", jump);
addEventListener("touchstart", jump);
addEventListener("keydown", e=>{
  if(e.code==="Space") jump();
});

function createPipe(){
  const gap = innerHeight * gapSize;
  const groundH = ground.offsetHeight;

  const offset = Math.random() *
    (innerHeight - gap - groundH - 120) + 60;

  ["top","bottom"].forEach(type=>{
    const p = document.createElement("div");
    p.className = "pipe " + type;
    p.style.height =
      type==="top" ? offset+"px" :
      (innerHeight-offset-gap-groundH)+"px";
    p.style.left = innerWidth + "px";
    game.appendChild(p);
    pipes.push(p);
  });
}

function updatePipes(){
  pipes.forEach((p,i)=>{
    let x = (parseFloat(p.style.left)||0) - pipeSpeed;
    p.style.left = x + "px";

    if(i%2===0 && x < bird.offsetLeft && !p.passed){
      p.passed = true;
      score++;

      if(score%5===0){
        pipeSpeed += 0.3;
        gapSize = Math.max(0.18, gapSize - 0.015);
      }
      scoreEl.innerText = `${score} | Best: ${best}`;
    }

    if(hit(p)) endGame();
    if(x < -120){ p.remove(); pipes.shift(); }
  });
}

function hit(pipe){
  const b = bird.getBoundingClientRect();
  const p = pipe.getBoundingClientRect();
  return !(b.right<p.left||b.left>p.right||b.bottom<p.top||b.top>p.bottom);
}

function endGame(){
  if(gameOver) return;
  gameOver = true;
  clearInterval(pipeTimer);

  if(score > best){
    best = score;
    localStorage.setItem("bestScore", best);
  }

  finalScore.innerText = `Score: ${score}\nBest: ${best}`;
  overlay.style.display = "flex";
}

function restart(){
  init();
  pipeTimer = setInterval(createPipe, 1500);
  loop();
}

function loop(){
  if(gameOver) return;

  velocity += 0.45;
  birdY += velocity;

  if(birdY < 0) birdY = 0;
  if(birdY + bird.offsetHeight > innerHeight - ground.offsetHeight){
    endGame(); return;
  }

  bird.style.top = birdY + "px";

  groundX -= pipeSpeed;
  ground.style.backgroundPositionX = groundX + "px";

  updatePipes();
  requestAnimationFrame(loop);
}

init();
pipeTimer = setInterval(createPipe,1500);
loop();
</script>

</body>
</html>
